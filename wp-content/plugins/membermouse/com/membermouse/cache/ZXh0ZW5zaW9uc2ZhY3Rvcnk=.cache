/**
 *
 * MemberMouse(TM) (http://www.membermouse.com)
 * (c) MemberMouse, LLC. All rights reserved.
 * 
 * The Extentions Factory retrieves a requested extension based on a token, or all available extensions
 */
 
class MM_ExtensionsFactory 
{
	//used to hold instances of extensions that can be reused
	private static $instances = array();
	
	/**
	 * Retrieve all of the active extensions
	 * 
	 * @return an array containing all the available extension objects, keyed by the token
	 */
	public static function getActiveExtensions($autoloadDependencies=true)
	{
		$extensionsArray = self::getAvailableExtensions($autoloadDependencies);
		
		foreach ($extensionsArray as $token=>$extension)
		{
			if (!$extension->isActive())
			{
				unset($extensionsArray[$token]);
			}
		}
		
		return $extensionsArray;
	}
	
	/**
	 * Returns a specific extension. Enforces the singleton nature of extensions and returns an already instantiated instance if the 
	 * requested extension has already been created
	 * 
	 * @param String $extensionToken
	 * 
	 * @return MM_Extension An instance of the extension matching the supplied token, null if one can't be found
	 */
	public static function getExtension($extensionToken,$autoloadDependencies=true)
	{
		if (isset(MM_ExtensionsFactory::$instances[$extensionToken]) && (MM_ExtensionsFactory::$instances[$extensionToken] instanceof MM_Extension))
		{
			$ext = MM_ExtensionsFactory::$instances[$extensionToken];
			if ($autoloadDependencies)
			{
				$ext->loadDependencies();
			}
			return $ext;
		}
		
		switch ($extensionToken) 
		{
			case MM_Extension::$USERVOICE_TOKEN:
				MM_ExtensionsFactory::$instances[$extensionToken] = new MM_UserVoiceExtension($autoloadDependencies);
				break;
			case MM_Extension::$FACEBOOK_LOGIN_TOKEN:
				MM_ExtensionsFactory::$instances[$extensionToken] = new MM_FacebookLoginExtension($autoloadDependencies);
				break;
			case MM_Extension::$GOOGLE_LOGIN_TOKEN:
				MM_ExtensionsFactory::$instances[$extensionToken] = new MM_GoogleLoginExtension($autoloadDependencies);
				break;
			case MM_Extension::$TWITTER_LOGIN_TOKEN:
				MM_ExtensionsFactory::$instances[$extensionToken] = new MM_TwitterLoginExtension($autoloadDependencies);
				break;
			case MM_Extension::$BBPRESS_TOKEN:
				MM_ExtensionsFactory::$instances[$extensionToken] = new MM_BBPressExtension($autoloadDependencies);
				break;
			case MM_Extension::$GOOGLE_ECOMMERCE_TOKEN:
				// TODO MM_ExtensionsFactory::$instances[$extensionToken] = new MM_GoogleECommerceExtension();
				break;
			default:
				return null;
				break;
		}
		
		return MM_ExtensionsFactory::$instances[$extensionToken];
	}
	
	
	public static function getAvailableExtensions($autoloadDependencies=true)
	{
		$tokens = array(MM_Extension::$BBPRESS_TOKEN, 
						MM_Extension::$FACEBOOK_LOGIN_TOKEN,
						MM_Extension::$GOOGLE_LOGIN_TOKEN,
						MM_Extension::$TWITTER_LOGIN_TOKEN,
						MM_Extension::$USERVOICE_TOKEN
					);
		
		$extensions = array();
		foreach ($tokens as $token)
		{
			$ext = self::getExtension($token,$autoloadDependencies);
			if (($ext instanceof MM_Extension) && ($ext->hasPermission()))
			{
				$extensions[$token] = $ext;			
			}
		}
		return $extensions;
	}
}
